// Static styles - specificity (0,1,0) and higher.
.wp-block-spectra-container {
	max-width: 100%;
	padding: 10px;
	box-sizing: border-box;
	position: relative;

	// Reset CSS variables for nested containers to prevent inheritance
	.wp-block-spectra-container {
		--spectra-overlay-opacity: initial;
	}

	> * {
		z-index: 0;
		position: relative;
	}

	// Ensure all pseudo-elements inherit border-radius for overlay effects
	&::before,
	&::after {
		border-radius: inherit;
	}
	&:not(.alignfull) {
		width: 100%;
	}

	// Apply overflow clip when has video background and border-radius
	&.has-video-background,
	&.has-image-background {
		&[style*="border-radius"] {
			overflow: hidden; // Fallback for older browsers
			overflow: clip !important;   // Modern standard for proper border-radius clipping
		}
	}

	// Only clip overflow when there are background images/videos that need border-radius clipping
	// This allows negative margins to work properly when no background is present
	&.has-image-background[style*="border-radius"],
	&.spectra-background-image[style*="border-radius"] {
		overflow: hidden; // Fallback for older browsers
		overflow: clip !important;   // Modern standard for proper border-radius clipping
	}

	// Default flex-wrap overriding for flex layout.
	&.wp-block-spectra-container-is-layout-flex {
		flex-wrap: nowrap;
	}


	// Dynamic styles - specificity (0,2,0) and higher.
	&[class*="wp-block"] {
		// WordPress core color picker support - ensure children inherit colors.
		&.has-text-color {
			// All children should inherit the WordPress core color.
			* {
				color: inherit;
			}
		}

		// WordPress core background color support.
		&.has-background {
			// WordPress core background should be respected.
			background: inherit;
		}

		// Text color of content inside container.
		&.spectra-text-color {
			color: var(--spectra-text-color);

			* {
				color: inherit;
			}
		}

		// Variable based CSS - Simple Background Color (only when no background image).
		&.spectra-background-color:not(.spectra-background-image) {
			// Create isolation to prevent opacity from affecting children
			isolation: isolate;

			&::before {
				content: "";
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: var(--spectra-background-color);
				opacity: var(--spectra-overlay-opacity, 1);
				pointer-events: none;
			}
		}

		// Variable based CSS - Simple Background Gradient (only when no background image).
		&.spectra-background-gradient:not(.spectra-background-image) {
			// Create isolation to prevent opacity from affecting children
			isolation: isolate;

			&::before {
				content: "";
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: var(--spectra-background-gradient);
				opacity: var(--spectra-overlay-opacity, 1);
				pointer-events: none;
			}
		}

		// Variable based CSS - Background Color with Background Image.
		&.spectra-background-color.spectra-background-image {
			position: relative;
			// Create isolation to prevent opacity from affecting children
			isolation: isolate;

			&::before {
				content: "";
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: var(--spectra-background-color);
				opacity: var(--spectra-overlay-opacity, 1);
				pointer-events: none;
				z-index: 0;
			}

			> *:not(.spectra-background-video__wrapper) {
				position: relative;
				z-index: 3;
			}
		}

		// Variable based CSS - Background Gradient with Background Image.
		&.spectra-background-gradient.spectra-background-image {
			position: relative;
			// Create isolation to prevent opacity from affecting children
			isolation: isolate;

			&::before {
				content: "";
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: var(--spectra-background-gradient);
				opacity: var(--spectra-overlay-opacity, 1);
				pointer-events: none;
				z-index: 0;
			}

			> *:not(.spectra-background-video__wrapper) {
				position: relative;
				z-index: 3;
			}
		}

		// -------------------------------- //
		// The hover states for this block. //
		// -------------------------------- //

		// Variable based CSS - Text Hover Color.
		&.spectra-text-color-hover:hover {
			color: var(--spectra-text-color-hover) !important;

			* {
				color: inherit !important;
			}
		}

		// Variable based CSS - Simple Background Color Hover (only when no background image).
		&.spectra-background-color-hover:not(.spectra-background-image):hover::before {
			background: var(--spectra-background-color-hover);
			opacity: var(--spectra-overlay-opacity, 1);
		}

		// Variable based CSS - Simple Background Gradient Hover (only when no background image).
		&.spectra-background-gradient-hover:not(.spectra-background-image):hover::before {
			background: var(--spectra-background-gradient-hover);
			opacity: var(--spectra-overlay-opacity, 1);
		}

		// Variable based CSS - Background Color Hover with Background Image.
		&.spectra-background-color-hover.spectra-background-image:hover::before {
			background: var(--spectra-background-color-hover);
			opacity: var(--spectra-overlay-opacity, 1);
		}

		// Variable based CSS - Background Gradient Hover with Background Image.
		&.spectra-background-gradient-hover.spectra-background-image:hover::before {
			background: var(--spectra-background-gradient-hover);
			opacity: var(--spectra-overlay-opacity, 1);
		}

		&.spectra-background-gradient:not(.has-video-background) {
			// Create isolation to prevent opacity from affecting children
			isolation: isolate;

			&::before {
				background: var(--spectra-background-gradient, var(--spectra-background-color));
				content: "";
				inset: 0;
				opacity: var(--spectra-overlay-opacity);
				position: absolute;
			}
		}

		// Variable based CSS - Container Overlay (only when no video background).
		&.has-container-overlay:not(.has-video-background) {
			position: relative;
			// Create stacking context for blend modes
			isolation: isolate;

			&::after {
				content: "";
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background-image: var(--spectra-overlay-image, none);
				background-position: var(--spectra-overlay-position, center);
				background-attachment: var(--spectra-overlay-attachment, scroll);
				background-repeat: var(--spectra-overlay-repeat, no-repeat);
				background-size: var(--spectra-overlay-size, cover);
				opacity: var(--spectra-overlay-opacity-value, 0);
				pointer-events: none;
				z-index: 1;
				border-radius: inherit;
				mix-blend-mode: var(--spectra-overlay-blend-mode, normal);
				background-blend-mode: var(--spectra-overlay-blend-mode, normal);
			}

			> * {
				position: relative;
				z-index: 2;
			}

			// Ensure overlay is hidden when no image is set
			&[style*="--spectra-overlay-image: none"]::after {
				display: none;
			}
		}

		// Video background specific styles
		&.has-video-background {
			.spectra-background-video__wrapper {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				z-index: -1;
				pointer-events: none;
				border-radius: inherit;

				video {
					width: 100%;
					height: 100%;
					object-fit: cover;
					border-radius: inherit;
				}
			}

			// Ensure content is above video
			> * {
				position: relative;
				z-index: 1;
			}
		}

		// Variable based CSS - Box Shadow.
		&.spectra-box-shadow {
			box-shadow: var(--spectra-box-shadow);
		}

		// Variable based CSS - Box Shadow Hover.
		// If hover shadow is set, use it; otherwise fall back to normal shadow
		&.spectra-box-shadow:hover {
			box-shadow: var(--spectra-box-shadow-hover, var(--spectra-box-shadow)) !important;
		}

		// Override for when hover shadow is explicitly set
		&.spectra-box-shadow-hover:hover {
			box-shadow: var(--spectra-box-shadow-hover) !important;
		}
	}
}
